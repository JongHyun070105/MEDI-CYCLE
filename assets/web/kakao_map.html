<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Kakao Maps SDK - appkey는 런타임에 치환될 예정 -->
    <script
      id="kakao-sdk"
      src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=__KAKAO_APP_KEY__&libraries=services"
    ></script>
    <style>
      html,
      body,
      #map {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script>
      (function () {
        function init() {
          if (!window.kakao || !window.kakao.maps) {
            setTimeout(init, 100);
            return;
          }
          var center = new kakao.maps.LatLng(37.4979, 127.0276); // 강남역 근처 기본값
          var map = new kakao.maps.Map(document.getElementById("map"), {
            center: center,
            level: 4,
          });
          // JS 브리지 메시지 수신: 위치 이동/마커 표시
          window.addEventListener("message", function (e) {
            try {
              var msg = JSON.parse(e.data);
              if (msg.type === "moveTo" && msg.lat && msg.lng) {
                var latlng = new kakao.maps.LatLng(msg.lat, msg.lng);
                map.setCenter(latlng);
              }
              if (msg.type === "markers" && Array.isArray(msg.items)) {
                msg.items.forEach(function (it) {
                  var m = new kakao.maps.Marker({
                    map: map,
                    position: new kakao.maps.LatLng(it.lat, it.lng),
                    title: it.name || "",
                  });
                });
              }
            } catch (err) {}
          });
        }
        init();
      })();
    </script>
  </body>
</html>
